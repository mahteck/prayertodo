# Phase II Implementation Plan â€“ SalaatFlow Full-Stack Web Application

**Project**: SalaatFlow â€“ Intelligent Prayer & Masjid Todo Assistant
**Phase**: II â€“ Full-Stack Web Application
**Plan Version**: 1.0
**Date**: 2025-12-27
**Status**: Ready for Execution

---

## Plan Overview

This plan breaks down Phase II implementation into **8 ordered steps**, progressing from environment setup through backend API, frontend development, integration, testing, and documentation. Each step defines clear goals, artifacts to be generated, and validation criteria.

### Implementation Method
**CRITICAL**: All production code will be **generated by Claude Code** based on the Phase II specification (`/specs/phase2-webapp.md`). The human will NOT write any manual production code. Claude Code will:
1. Read the specification
2. Generate complete, working code for each step
3. Validate against acceptance criteria
4. Iterate based on test results

---

## Step 1: Environment Setup & Database Foundation

### Goal
Establish project structure, configure development environment, set up Neon PostgreSQL database, and create base SQLModel models.

### Artifacts to Generate

**1. Backend Directory Structure**:
```
backend/
â”œâ”€â”€ main.py                      # FastAPI app entry point
â”œâ”€â”€ models.py                    # SQLModel models (Task, Masjid, Hadith)
â”œâ”€â”€ database.py                  # Database connection & session
â”œâ”€â”€ schemas.py                   # Pydantic request/response schemas
â”œâ”€â”€ config.py                    # Configuration and environment variables
â”œâ”€â”€ requirements.txt             # Python dependencies
â”œâ”€â”€ .env.example                 # Environment variable template
â”œâ”€â”€ alembic.ini                  # Alembic configuration
â””â”€â”€ alembic/
    â”œâ”€â”€ env.py                   # Alembic environment
    â””â”€â”€ versions/
        â””â”€â”€ initial_schema.py    # Initial migration
```

**2. Frontend Directory Structure**:
```
frontend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ layout.tsx              # Root layout
â”‚   â””â”€â”€ page.tsx                # Dashboard (placeholder)
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ types.ts                # TypeScript interfaces
â”‚   â””â”€â”€ utils.ts                # Helper functions
â”œâ”€â”€ package.json                # Dependencies
â”œâ”€â”€ tsconfig.json               # TypeScript config
â”œâ”€â”€ tailwind.config.js          # Tailwind CSS config
â”œâ”€â”€ next.config.js              # Next.js config
â””â”€â”€ .env.local.example          # Environment template
```

**3. Core Files**:

**`backend/models.py`**:
- `TaskCategory` enum
- `Priority` enum
- `Recurrence` enum
- `SpiritualTask` model (15 fields)
- `Masjid` model (14 fields)
- `DailyHadith` model (6 fields)

**`backend/database.py`**:
- Database engine setup
- Session dependency for FastAPI
- Table creation function

**`backend/config.py`**:
- Pydantic Settings for environment variables
- DATABASE_URL, CORS_ORIGINS configuration

**`frontend/lib/types.ts`**:
- `Task` interface
- `Masjid` interface
- `DailyHadith` interface
- `ApiResponse<T>` generic type

**4. Configuration Files**:

**`backend/requirements.txt`**:
```
fastapi==0.110.0
uvicorn[standard]==0.27.0
sqlmodel==0.0.14
psycopg2-binary==2.9.9
alembic==1.13.1
python-dotenv==1.0.0
pydantic==2.5.0
pydantic-settings==2.1.0
```

**`frontend/package.json`**:
```json
{
  "name": "salaatflow-frontend",
  "version": "0.1.0",
  "dependencies": {
    "next": "^14.0.4",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "axios": "^1.6.2",
    "typescript": "^5.3.3"
  },
  "devDependencies": {
    "@types/node": "^20.10.5",
    "@types/react": "^18.2.45",
    "tailwindcss": "^3.4.0",
    "eslint": "^8.56.0",
    "eslint-config-next": "^14.0.4"
  }
}
```

**5. Database Setup**:
- Neon PostgreSQL project created
- Connection string configured
- Initial migration created and applied

### Validation Criteria

- [ ] Backend directory structure exists with all files
- [ ] Frontend directory structure exists with all files
- [ ] `backend/requirements.txt` installs without errors
- [ ] `frontend/package.json` npm install completes
- [ ] Database connection test succeeds
- [ ] SQLModel models import without errors
- [ ] Alembic migration creates all 3 tables
- [ ] TypeScript types compile without errors

**Validation Commands**:

```bash
# Backend setup
cd backend
python -m venv venv
source venv/bin/activate  # or venv\Scripts\activate on Windows
pip install -r requirements.txt
python -c "from models import SpiritualTask, Masjid, DailyHadith; print('âœ“ Models imported')"

# Database migration
alembic upgrade head

# Verify tables created
psql $DATABASE_URL -c "\dt"
# Expected: spiritual_tasks, masjids, daily_hadiths

# Frontend setup
cd ../frontend
npm install
npm run build
# Expected: No TypeScript errors
```

**Environment Setup**:
```bash
# backend/.env
DATABASE_URL=postgresql://user:pass@host/salaatflow_db
CORS_ORIGINS=http://localhost:3000

# frontend/.env.local
NEXT_PUBLIC_API_URL=http://localhost:8000/api/v1
```

---

## Step 2: Backend API - Core CRUD (Tasks)

### Goal
Implement FastAPI backend with complete CRUD operations for SpiritualTask, including filtering, sorting, and search.

### Artifacts to Generate

**1. Backend Files**:

**`backend/routers/`**:
```
routers/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ tasks.py                    # Task endpoints
â””â”€â”€ health.py                   # Health check endpoint
```

**`backend/crud.py`**:
- `create_task(db, task_data)`
- `get_task(db, task_id)`
- `list_tasks(db, filters, sort, pagination)`
- `update_task(db, task_id, updates)`
- `delete_task(db, task_id)`
- `toggle_task_completion(db, task_id)`

**`backend/routers/tasks.py`**:
- `POST /api/v1/tasks` - Create task
- `GET /api/v1/tasks` - List tasks with filters
- `GET /api/v1/tasks/{id}` - Get single task
- `PUT /api/v1/tasks/{id}` - Update task
- `DELETE /api/v1/tasks/{id}` - Delete task
- `PATCH /api/v1/tasks/{id}/toggle` - Toggle completion

**`backend/schemas.py`**:
- `TaskCreate` schema (request body)
- `TaskUpdate` schema (partial update)
- `TaskResponse` schema (response)
- `TaskListResponse` schema (paginated list)

**`backend/main.py`**:
- FastAPI app initialization
- CORS middleware configuration
- Router registration
- Startup/shutdown events for database

**2. Query Features**:
- Status filter: `all`, `pending`, `completed`
- Category filter: enum validation
- Priority filter: enum validation
- Masjid filter: by ID
- Area filter: via masjid relationship
- Search: title + description (case-insensitive)
- Sort: by title, due_date, priority, created_at
- Pagination: limit + offset

### Validation Criteria

- [ ] FastAPI app starts without errors
- [ ] Swagger docs accessible at `http://localhost:8000/docs`
- [ ] All 6 task endpoints documented in Swagger
- [ ] Create task returns 201 with task ID
- [ ] Create task validates required fields (422 on missing title)
- [ ] List tasks returns empty array initially
- [ ] List tasks with status=pending filters correctly
- [ ] List tasks with search=Fajr returns matching tasks
- [ ] List tasks with sort_by=priority orders correctly
- [ ] Get task by ID returns 200 with task details
- [ ] Get non-existent task returns 404
- [ ] Update task modifies fields and updates timestamp
- [ ] Delete task returns 204
- [ ] Toggle task switches completed status

**Validation Commands**:

```bash
# Start backend server
cd backend
uvicorn main:app --reload

# Test with curl or httpie
# Create task
curl -X POST http://localhost:8000/api/v1/tasks \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Attend Fajr",
    "category": "Farz",
    "priority": "High"
  }'

# List tasks
curl http://localhost:8000/api/v1/tasks

# Filter tasks
curl "http://localhost:8000/api/v1/tasks?status=pending&sort_by=priority"

# Get task
curl http://localhost:8000/api/v1/tasks/1

# Update task
curl -X PUT http://localhost:8000/api/v1/tasks/1 \
  -H "Content-Type: application/json" \
  -d '{"completed": true}'

# Toggle task
curl -X PATCH http://localhost:8000/api/v1/tasks/1/toggle

# Delete task
curl -X DELETE http://localhost:8000/api/v1/tasks/1
```

**Automated Tests** (optional for Step 2):
```python
# backend/tests/test_tasks.py
from fastapi.testclient import TestClient
from main import app

client = TestClient(app)

def test_create_task():
    response = client.post("/api/v1/tasks", json={
        "title": "Test Task",
        "category": "Farz",
        "priority": "High"
    })
    assert response.status_code == 201
    assert "id" in response.json()

def test_list_tasks():
    response = client.get("/api/v1/tasks")
    assert response.status_code == 200
    assert "tasks" in response.json()

# ... more tests
```

---

## Step 3: Backend API - Masjid & Hadith Endpoints

### Goal
Implement Masjid and DailyHadith CRUD operations, including area filtering and today's hadith endpoint.

### Artifacts to Generate

**1. Backend Files**:

**`backend/routers/masjids.py`**:
- `POST /api/v1/masjids` - Create masjid
- `GET /api/v1/masjids` - List masjids with area filter
- `GET /api/v1/masjids/{id}` - Get single masjid
- `PUT /api/v1/masjids/{id}` - Update masjid
- `DELETE /api/v1/masjids/{id}` - Delete masjid

**`backend/routers/hadiths.py`**:
- `GET /api/v1/hadith/today` - Get today's hadith
- `GET /api/v1/hadiths` - List all hadiths (admin)
- `POST /api/v1/hadiths` - Create hadith (admin)

**`backend/routers/utility.py`**:
- `GET /api/v1/health` - Health check
- `GET /api/v1/areas` - List unique areas from Masjid table

**`backend/crud.py`** (add functions):
- `create_masjid(db, masjid_data)`
- `get_masjid(db, masjid_id)`
- `list_masjids(db, area_name)`
- `update_masjid(db, masjid_id, updates)`
- `delete_masjid(db, masjid_id)`
- `get_todays_hadith(db, language)`
- `get_unique_areas(db)`

**`backend/schemas.py`** (add schemas):
- `MasjidCreate`, `MasjidUpdate`, `MasjidResponse`
- `HadithCreate`, `HadithResponse`
- `AreasResponse`

**2. Update `backend/main.py`**:
- Register masjid router
- Register hadith router
- Register utility router

### Validation Criteria

- [ ] All new endpoints appear in Swagger docs
- [ ] Create masjid with all prayer times returns 201
- [ ] List masjids with area_name filter returns filtered results
- [ ] Get masjid returns all prayer times
- [ ] Update masjid prayer times persists changes
- [ ] Get /api/v1/areas returns unique area list
- [ ] Get today's hadith returns hadith for current date
- [ ] Get today's hadith with no entry returns 404
- [ ] Create hadith persists to database

**Validation Commands**:

```bash
# Create masjid
curl -X POST http://localhost:8000/api/v1/masjids \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Masjid Al-Huda",
    "area_name": "DHA Phase 5",
    "address": "123 Main St",
    "fajr_time": "05:30",
    "dhuhr_time": "13:00",
    "asr_time": "16:30",
    "maghrib_time": "18:15",
    "isha_time": "19:45",
    "jummah_time": "13:30"
  }'

# List masjids
curl http://localhost:8000/api/v1/masjids

# Filter by area
curl "http://localhost:8000/api/v1/masjids?area_name=DHA%20Phase%205"

# Get areas
curl http://localhost:8000/api/v1/areas

# Create hadith
curl -X POST http://localhost:8000/api/v1/hadiths \
  -H "Content-Type: application/json" \
  -d '{
    "content": "The best of people are those who are most beneficial.",
    "reference": "Sahih al-Jami 3289",
    "language": "en",
    "display_date": "2025-12-27T00:00:00Z"
  }'

# Get today's hadith
curl http://localhost:8000/api/v1/hadith/today
```

---

## Step 4: Backend - Seed Data & Advanced Features

### Goal
Create seed data script, implement task-masjid relationship queries, and add advanced filtering logic.

### Artifacts to Generate

**1. Seed Script**:

**`backend/seed.py`**:
```python
"""Seed database with sample data."""

def seed_masjids():
    # Create 5-10 masjids across different areas
    # DHA Phase 5, Gulshan-e-Iqbal, Clifton, Malir, etc.
    pass

def seed_tasks():
    # Create 20-30 sample tasks
    # Mix of categories, priorities, masjid associations
    pass

def seed_hadiths():
    # Create 7-10 hadiths for next week
    pass

if __name__ == "__main__":
    seed_masjids()
    seed_tasks()
    seed_hadiths()
    print("âœ“ Seed data created successfully")
```

**2. Advanced Query Features**:

Update `backend/crud.py`:
- Add task filtering by masjid relationship
- Add task filtering by area via masjid
- Implement full-text search on title + description
- Add sorting with multiple fields
- Optimize queries with eager loading (joinedload)

**3. Relationship Queries**:

Update `backend/routers/tasks.py`:
- Include masjid details in task responses
- Filter tasks by area_name via masjid join

Update `backend/routers/masjids.py`:
- Include task count in masjid list response
- Add option to include associated tasks in detail view

### Validation Criteria

- [ ] Seed script runs without errors
- [ ] Database contains 5+ masjids after seeding
- [ ] Database contains 20+ tasks after seeding
- [ ] Database contains 7+ hadiths after seeding
- [ ] List tasks with masjid_id filter returns correct tasks
- [ ] List tasks with area_name filter uses masjid join
- [ ] Task response includes masjid details (name, area)
- [ ] Search query finds tasks by partial title match
- [ ] Sorting by multiple fields works correctly

**Validation Commands**:

```bash
# Run seed script
cd backend
python seed.py

# Verify seed data
curl http://localhost:8000/api/v1/masjids | jq '.total'
# Expected: >= 5

curl http://localhost:8000/api/v1/tasks | jq '.total'
# Expected: >= 20

# Test advanced filters
curl "http://localhost:8000/api/v1/tasks?masjid_id=1"
curl "http://localhost:8000/api/v1/tasks?area_name=DHA%20Phase%205"
curl "http://localhost:8000/api/v1/tasks?search=Fajr"
curl "http://localhost:8000/api/v1/tasks?sort_by=due_date&sort_order=asc"

# Verify masjid includes in task response
curl http://localhost:8000/api/v1/tasks/1 | jq '.masjid'
# Expected: {id, name, area_name, ...}
```

---

## Step 5: Frontend - API Client & Type System

### Goal
Create TypeScript API client, define all interfaces, and implement API communication layer.

### Artifacts to Generate

**1. Type Definitions**:

**`frontend/lib/types.ts`**:
```typescript
export interface Task {
  id: number;
  title: string;
  description?: string;
  category: 'Farz' | 'Sunnah' | 'Nafl' | 'Deed' | 'Other';
  priority: 'High' | 'Medium' | 'Low';
  tags: string[];
  masjid_id?: number;
  masjid?: Masjid;
  due_datetime?: string;
  recurrence: 'None' | 'Daily' | 'Weekly' | 'Monthly';
  completed: boolean;
  created_at: string;
  updated_at: string;
}

export interface Masjid {
  id: number;
  name: string;
  area_name: string;
  address?: string;
  latitude?: number;
  longitude?: number;
  fajr_time: string;
  dhuhr_time: string;
  asr_time: string;
  maghrib_time: string;
  isha_time: string;
  jummah_time?: string;
  created_at: string;
  updated_at: string;
}

export interface DailyHadith {
  id: number;
  content: string;
  reference: string;
  language: string;
  display_date: string;
  created_at: string;
}

export interface TaskFilters {
  status?: 'all' | 'pending' | 'completed';
  category?: string;
  priority?: string;
  masjid_id?: number;
  area_name?: string;
  search?: string;
  sort_by?: string;
  sort_order?: 'asc' | 'desc';
  limit?: number;
  offset?: number;
}
```

**2. API Client**:

**`frontend/lib/api.ts`**:
```typescript
import axios from 'axios';
import { Task, Masjid, DailyHadith, TaskFilters } from './types';

const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000/api/v1';

const api = axios.create({
  baseURL: API_BASE_URL,
  headers: {
    'Content-Type': 'application/json',
  },
});

// Task API
export const taskApi = {
  list: async (filters?: TaskFilters) => {
    const response = await api.get('/tasks', { params: filters });
    return response.data;
  },
  get: async (id: number) => {
    const response = await api.get(`/tasks/${id}`);
    return response.data;
  },
  create: async (data: Partial<Task>) => {
    const response = await api.post('/tasks', data);
    return response.data;
  },
  update: async (id: number, data: Partial<Task>) => {
    const response = await api.put(`/tasks/${id}`, data);
    return response.data;
  },
  delete: async (id: number) => {
    await api.delete(`/tasks/${id}`);
  },
  toggle: async (id: number) => {
    const response = await api.patch(`/tasks/${id}/toggle`);
    return response.data;
  },
};

// Masjid API
export const masjidApi = {
  list: async (area_name?: string) => {
    const response = await api.get('/masjids', { params: { area_name } });
    return response.data;
  },
  get: async (id: number) => {
    const response = await api.get(`/masjids/${id}`);
    return response.data;
  },
};

// Hadith API
export const hadithApi = {
  today: async (language = 'en') => {
    const response = await api.get('/hadith/today', { params: { language } });
    return response.data;
  },
};

// Utility API
export const utilityApi = {
  areas: async () => {
    const response = await api.get('/areas');
    return response.data;
  },
};
```

**3. Utility Functions**:

**`frontend/lib/utils.ts`**:
```typescript
export function formatDate(dateString: string): string {
  // Format ISO date to readable format
}

export function formatTime(timeString: string): string {
  // Format HH:MM to 12-hour format
}

export function getPriorityColor(priority: string): string {
  // Return Tailwind color class
}

export function getCategoryIcon(category: string): string {
  // Return emoji or icon for category
}
```

### Validation Criteria

- [ ] TypeScript compiles without errors
- [ ] All API client functions have correct types
- [ ] API client can be imported in components
- [ ] Mock API calls return expected types
- [ ] Environment variable NEXT_PUBLIC_API_URL is read correctly

**Validation Commands**:

```bash
cd frontend

# Type check
npm run build
# Expected: No TypeScript errors

# Test API client imports
cat > test-api.ts << 'EOF'
import { taskApi, masjidApi } from './lib/api';

async function test() {
  const tasks = await taskApi.list();
  console.log('Tasks:', tasks);
}
EOF

npx tsx test-api.ts
# Expected: Fetches tasks from backend (if running)
```

---

## Step 6: Frontend - Core Components & Pages

### Goal
Build reusable React components and implement main pages (Dashboard, Task List, Task Form).

### Artifacts to Generate

**1. Reusable Components**:

**`frontend/components/TaskCard.tsx`**:
- Props: task, onToggleComplete, onEdit, onDelete
- Displays: checkbox, title, priority badge, category, due date
- Actions: Edit button, Delete button

**`frontend/components/TaskFilters.tsx`**:
- Props: filters, onFilterChange, masjids
- Controls: Search input, Status dropdown, Category dropdown, Priority dropdown, Masjid dropdown, Sort controls
- Features: Debounced search, Clear filters button

**`frontend/components/DailyHadithBox.tsx`**:
- Props: language (optional)
- Fetches today's hadith on mount
- Displays: Bismillah header, hadith content, reference
- States: Loading, Error, Success

**`frontend/components/MasjidCard.tsx`**:
- Props: masjid
- Displays: Name, area, all 5 prayer times
- Actions: View details link

**`frontend/components/PriorityBadge.tsx`**:
- Props: priority
- Renders: Color-coded badge (High=red, Medium=yellow, Low=green)

**`frontend/components/Navbar.tsx`**:
- Links: Home, Tasks, Masjids
- Actions: Add Task button

**2. Main Pages**:

**`frontend/app/page.tsx`** (Dashboard):
```tsx
export default function Dashboard() {
  // Fetch upcoming tasks (limit 10)
  // Fetch areas
  // Render: DailyHadithBox, Task preview list, Area selector
}
```

**`frontend/app/tasks/page.tsx`** (Task List):
```tsx
export default function TaskListPage() {
  // State: tasks, filters, loading
  // Fetch tasks with filters
  // Render: TaskFilters, TaskCard list, Pagination
}
```

**`frontend/app/tasks/new/page.tsx`** (Create Task):
```tsx
export default function NewTaskPage() {
  // State: form data, masjids
  // Handle submit: call taskApi.create
  // Redirect to /tasks on success
  // Render: TaskForm
}
```

**`frontend/app/tasks/[id]/edit/page.tsx`** (Edit Task):
```tsx
export default function EditTaskPage({ params }) {
  // Fetch task by ID
  // Pre-populate form
  // Handle submit: call taskApi.update
  // Render: TaskForm with current values
}
```

**3. Form Component**:

**`frontend/components/TaskForm.tsx`**:
- Props: task (optional, for edit), onSubmit, onCancel
- Fields: title, description, category, priority, tags, masjid, due_datetime, recurrence
- Validation: Client-side validation with error messages
- Submit: Calls parent onSubmit callback

### Validation Criteria

- [ ] All components compile without TypeScript errors
- [ ] Dashboard page loads without errors
- [ ] Task list page displays tasks from API
- [ ] Task filters update task list when changed
- [ ] Create task form submits successfully
- [ ] Edit task form pre-populates with task data
- [ ] DailyHadithBox displays today's hadith
- [ ] MasjidCard displays all prayer times
- [ ] Navbar links navigate correctly
- [ ] Priority badges show correct colors
- [ ] Task completion checkbox toggles status

**Validation Commands**:

```bash
# Start frontend dev server
cd frontend
npm run dev

# Open browser to http://localhost:3000
# Manual testing checklist:
# - Dashboard loads with hadith and tasks
# - Click "Tasks" in navbar â†’ task list appears
# - Use filters â†’ task list updates
# - Click "Add Task" â†’ form appears
# - Fill form and submit â†’ task created, redirected to list
# - Click task "Edit" â†’ form pre-populated
# - Update and submit â†’ task updated
# - Click checkbox â†’ task completion toggles
# - Click "Delete" â†’ confirmation, then task removed
```

---

## Step 7: Frontend - Masjid Pages & Advanced Features

### Goal
Implement masjid-related pages, area filtering, and complete all remaining UI features.

### Artifacts to Generate

**1. Masjid Pages**:

**`frontend/app/masjids/page.tsx`** (Masjid List):
```tsx
export default function MasjidListPage() {
  // State: masjids, selectedArea
  // Fetch areas
  // Fetch masjids filtered by area
  // Render: Area dropdown, MasjidCard list
}
```

**`frontend/app/masjids/[id]/page.tsx`** (Masjid Detail):
```tsx
export default function MasjidDetailPage({ params }) {
  // Fetch masjid by ID
  // Fetch tasks associated with this masjid
  // Render: Full masjid details, prayer timetable, associated tasks
}
```

**2. Advanced Components**:

**`frontend/components/MasjidSelector.tsx`**:
- Props: onAreaChange, onMasjidSelect
- Features: Area dropdown, Masjid list for selected area
- Used in: Dashboard, Task filters

**`frontend/components/TaskList.tsx`**:
- Props: tasks, loading, onToggleComplete, onEdit, onDelete
- Features: Map over tasks, render TaskCard for each
- States: Loading spinner, Empty state message

**`frontend/components/Pagination.tsx`**:
- Props: total, limit, offset, onPageChange
- Features: Previous/Next buttons, Page numbers
- Used in: Task list page

**3. Styling & UX**:

**Update `frontend/app/layout.tsx`**:
- Add Navbar component
- Add Tailwind global styles
- Add metadata (title, description)

**Create `frontend/app/globals.css`**:
- Tailwind directives
- Custom styles for Islamic patterns (optional)
- Prayer time table styles

### Validation Criteria

- [ ] Masjid list page displays all masjids
- [ ] Area filter reduces masjid list to selected area
- [ ] Masjid detail page shows full information
- [ ] Masjid detail shows associated tasks
- [ ] MasjidSelector updates on area change
- [ ] Task list pagination works correctly
- [ ] Empty states display appropriate messages
- [ ] Loading states show spinners
- [ ] All pages are mobile-responsive
- [ ] Navigation between pages works smoothly

**Validation Commands**:

```bash
# Manual UI testing
# 1. Navigate to /masjids
# 2. Select area from dropdown â†’ verify filtered list
# 3. Click masjid â†’ detail page loads
# 4. Verify prayer times displayed
# 5. Verify associated tasks shown (if any)
# 6. Test pagination on task list (if >10 tasks)
# 7. Test mobile view (resize browser to phone width)
```

---

## Step 8: Integration Testing, Documentation & Deployment Prep

### Goal
Perform end-to-end integration testing, complete documentation, and prepare for deployment.

### Artifacts to Generate

**1. Integration Tests**:

**`backend/tests/test_integration.py`**:
```python
def test_create_task_with_masjid():
    # Create masjid
    # Create task linked to masjid
    # Verify task includes masjid details
    pass

def test_filter_tasks_by_area():
    # Create masjids in different areas
    # Create tasks linked to masjids
    # Filter tasks by area via masjid
    # Verify correct tasks returned
    pass

def test_search_and_sort():
    # Create multiple tasks
    # Search by keyword
    # Sort by priority
    # Verify results
    pass
```

**`frontend/tests/integration.spec.ts`** (Playwright or manual):
```typescript
// Test: Create task linked to masjid
// 1. Navigate to /tasks/new
// 2. Fill title, category, select masjid
// 3. Submit
// 4. Verify task appears in list with masjid name

// Test: Filter tasks by status
// 1. Create pending and completed tasks
// 2. Filter by "Completed"
// 3. Verify only completed tasks shown

// ... more tests
```

**2. Documentation**:

**`backend/README.md`**:
- Backend setup instructions
- Database connection guide
- API endpoint documentation (link to Swagger)
- Environment variables
- Running tests

**`frontend/README.md`**:
- Frontend setup instructions
- Environment variables
- Running dev server
- Building for production
- Component documentation

**`README.md`** (root):
- Project overview
- Phase II features
- Full stack architecture diagram
- Setup instructions (backend + frontend)
- Testing guide
- Deployment notes (future phases)

**`TESTING.md`**:
- Backend API test scenarios (30+ cases from spec)
- Frontend UI test scenarios
- Integration test scenarios
- Manual testing checklist

**3. Deployment Preparation**:

**`backend/Dockerfile`** (for future use):
```dockerfile
FROM python:3.11-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
```

**`frontend/Dockerfile`** (for future use):
```dockerfile
FROM node:20-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build
CMD ["npm", "start"]
```

**`docker-compose.yml`** (development):
```yaml
version: '3.8'
services:
  backend:
    build: ./backend
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=${DATABASE_URL}
    depends_on:
      - db

  frontend:
    build: ./frontend
    ports:
      - "3000:3000"
    environment:
      - NEXT_PUBLIC_API_URL=http://localhost:8000/api/v1

  db:
    image: postgres:15
    environment:
      POSTGRES_DB: salaatflow_db
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
    ports:
      - "5432:5432"
```

### Validation Criteria

**Backend Tests**:
- [ ] All unit tests pass (pytest)
- [ ] All integration tests pass
- [ ] Test coverage >80%
- [ ] All API endpoints tested

**Frontend Tests**:
- [ ] Component tests pass
- [ ] Integration tests pass (manual or automated)
- [ ] No TypeScript errors in production build
- [ ] All user workflows tested

**Documentation**:
- [ ] Backend README complete with setup steps
- [ ] Frontend README complete with dev instructions
- [ ] Root README has architecture overview
- [ ] TESTING.md has all test scenarios
- [ ] API documented in Swagger
- [ ] Environment variables documented

**Integration Validation**:
- [ ] Full workflow: Create task with masjid â†’ View in list â†’ Edit â†’ Complete â†’ Delete
- [ ] Full workflow: Filter tasks by area â†’ Sort by priority â†’ Search
- [ ] Full workflow: View masjid â†’ See tasks â†’ View prayer times
- [ ] Dashboard shows hadith + tasks correctly
- [ ] All CORS issues resolved
- [ ] Database persists data correctly
- [ ] Seed data can be loaded

**Validation Commands**:

```bash
# Backend tests
cd backend
pytest tests/ -v --cov=. --cov-report=html
# Expected: All tests pass, >80% coverage

# Frontend build
cd frontend
npm run build
# Expected: Production build succeeds

# Integration test (manual)
# Start both servers
cd backend && uvicorn main:app --reload &
cd frontend && npm run dev &

# Follow test scenarios in TESTING.md
# Mark each scenario PASS/FAIL

# Docker compose test (optional)
docker-compose up
# Verify all services start
# Test full application via browser
```

---

## Implementation Workflow

### For Claude Code (AI Implementation Agent)

Each step will be implemented as follows:

1. **Read** Phase II specification (`/specs/phase2-webapp.md`)
2. **Read** this implementation plan
3. **Generate** code for the current step's artifacts
4. **Validate** using the step's validation criteria
5. **Test** using provided commands or test scripts
6. **Document** any deviations or issues
7. **Proceed** to next step only when current step passes validation

### For Human (Project Owner)

The human will:
1. **Set up** Neon PostgreSQL database (Step 1)
2. **Configure** environment variables (.env files)
3. **Invoke** `/sp.tasks` to break this plan into executable tasks
4. **Invoke** `/sp.implement` to have Claude Code generate code
5. **Execute** validation commands as specified
6. **Run** manual tests where specified
7. **Provide feedback** if behavior doesn't match spec
8. **Approve** each step before proceeding to next

### Critical Reminders

ðŸš¨ **NO MANUAL CODING**: The human must not write production code. All code generated by Claude Code.

ðŸš¨ **SPEC IS SOURCE OF TRUTH**: If generated code doesn't match spec, regenerate code (don't patch spec).

ðŸš¨ **VALIDATE EACH STEP**: Don't proceed to next step until current step's validation passes.

ðŸš¨ **DATABASE REQUIRED**: Neon PostgreSQL must be set up before Step 1 validation.

ðŸš¨ **BOTH SERVERS**: Backend and frontend must run simultaneously for integration testing.

---

## Success Criteria for Phase II Completion

Phase II is considered **complete** when:

### Backend âœ…
- âœ… All 8 steps executed and validated
- âœ… 20+ API endpoints implemented and documented
- âœ… Database has 3 tables with proper relationships
- âœ… Seed data script populates sample data
- âœ… All CRUD operations work correctly
- âœ… Filtering, sorting, searching implemented
- âœ… Swagger docs accessible and accurate
- âœ… Backend tests pass with >80% coverage

### Frontend âœ…
- âœ… 6+ pages implemented (Dashboard, Task List/Create/Edit, Masjid List/Detail)
- âœ… 8+ reusable components working
- âœ… TypeScript types for all API responses
- âœ… API client handles all endpoints
- âœ… Filtering, sorting, searching in UI
- âœ… Mobile-responsive design
- âœ… Loading and error states
- âœ… Production build succeeds

### Integration âœ…
- âœ… Backend-frontend communication works
- âœ… CORS properly configured
- âœ… All user workflows testable
- âœ… Database persistence verified
- âœ… Masjid-task relationships functional
- âœ… Daily hadith displays correctly
- âœ… 30+ acceptance criteria from spec tested and passing

### Documentation âœ…
- âœ… README files complete for backend, frontend, root
- âœ… TESTING.md with all test scenarios
- âœ… API documentation (Swagger)
- âœ… Environment setup guide
- âœ… Architecture documented

---

## Phase II to Phase III Evolution Path

Upon completion of Phase II, the following will be added in Phase III:

| Phase II Component | Phase III Addition |
|-------------------|-------------------|
| Basic recurrence (enum) | Advanced recurring task logic |
| Manual task creation | AI chatbot natural language creation |
| Static prayer times | Dynamic prayer time calculation |
| Manual reminders | Intelligent reminder system |
| Basic filters | AI-powered smart filters |
| REST API | MCP SDK tool integrations |

**DO NOT implement** AI features in Phase II. Keep focus on stable full-stack CRUD application.

---

## Estimated Effort (For Planning Only)

| Step | Description | Complexity | Key Risk |
|------|-------------|------------|----------|
| 1 | Environment Setup | Medium | Database connection issues |
| 2 | Backend Tasks CRUD | High | Complex filtering/sorting logic |
| 3 | Backend Masjid/Hadith | Medium | Relationship queries |
| 4 | Seed Data & Advanced | Medium | Query optimization |
| 5 | Frontend API Client | Low | TypeScript type accuracy |
| 6 | Core Components/Pages | High | State management complexity |
| 7 | Masjid Pages & UI | Medium | Area filtering logic |
| 8 | Testing & Docs | Medium | Integration test coverage |

**Note**: No time estimates provided per project constitution guidelines. Focus is on completeness, not speed.

**Estimated Total**: 2-3 weeks full-time development (for reference only)

---

## References

- **Specification**: `/specs/phase2-webapp.md`
- **Phase I Implementation**: `/phase1/`
- **Global Constitution**: `/specs/constitution.md`
- **Next Steps**: `/sp.tasks` to generate task list from this plan

---

**Plan Status**: âœ… Ready for Task Breakdown
**Next Command**: `/sp.tasks` to generate Phase II task list
